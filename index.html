<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Netlify Projects Gallery</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #0a0a0a;
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 2rem;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 6rem 2rem 4rem;
            background: linear-gradient(180deg, #0a0f1b 0%, #050a15 100%);
            position: relative;
            overflow: hidden;
        }
        
        /* Subtle gradient mesh */
        .header::before {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background: radial-gradient(ellipse at top, rgba(37, 99, 235, 0.15) 0%, transparent 50%),
                        radial-gradient(ellipse at bottom left, rgba(168, 85, 247, 0.1) 0%, transparent 50%),
                        radial-gradient(ellipse at bottom right, rgba(6, 182, 212, 0.1) 0%, transparent 50%);
            opacity: 0.7;
            z-index: 0;
        }
        
        /* Professional grid pattern */
        .header::after {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background-image: 
                linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 0.5;
            z-index: 0;
        }
        
        /* Subtle floating dots */
        .particles {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 1;
            opacity: 0.3;
        }
        
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            border-radius: 50%;
            animation: float-subtle 30s linear infinite;
        }
        
        @keyframes float-subtle {
            0% { transform: translateY(100vh) scale(0); opacity: 0; }
            10% { opacity: 0.5; }
            90% { opacity: 0.5; }
            100% { transform: translateY(-100vh) scale(1); opacity: 0; }
        }
        
        .header-content {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }

        .header h1 {
            font-size: 3.5rem;
            font-weight: 800;
            color: #ffffff;
            margin-bottom: 1rem;
            letter-spacing: -1px;
            position: relative;
            animation: fade-in 0.8s ease-out;
        }
        
        .header h1::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, transparent, #3b82f6, transparent);
            animation: expand 1.5s ease-out;
        }
        
        @keyframes expand {
            0% { width: 0; }
            100% { width: 80px; }
        }
        
        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header p {
            color: #94a3b8;
            font-size: 1.25rem;
            font-weight: 400;
            margin-bottom: 2.5rem;
            line-height: 1.6;
            animation: fade-in 0.8s ease-out;
            animation-delay: 0.2s;
            animation-fill-mode: backwards;
        }
        
        @keyframes fade-in-up {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .header-badges {
            display: flex;
            gap: 2rem;
            justify-content: center;
            flex-wrap: wrap;
            animation: fade-in 0.8s ease-out;
            animation-delay: 0.4s;
            animation-fill-mode: backwards;
        }
        
        .header-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.625rem;
            padding: 0.75rem 1.25rem;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        
        .header-badge::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .header-badge:hover::before {
            opacity: 1;
        }
        
        .header-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            border-color: rgba(255,255,255,0.15);
        }
        
        .header-badge:nth-child(1) .header-badge-icon { color: #60a5fa; }
        .header-badge:nth-child(2) .header-badge-icon { color: #34d399; }
        .header-badge:nth-child(3) .header-badge-icon { color: #fbbf24; }
        .header-badge:nth-child(4) .header-badge-icon { color: #a78bfa; }
        
        .header-badge-icon {
            width: 20px;
            height: 20px;
            display: inline-block;
            transition: transform 0.2s ease;
        }
        
        .header-badge:hover .header-badge-icon {
            transform: scale(1.1);
        }
        
        .header-badge-number {
            font-weight: 700;
            color: #ffffff;
            font-size: 1.125rem;
            font-variant-numeric: tabular-nums;
        }
        
        .header-badge-label {
            color: #94a3b8;
            font-weight: 500;
            font-size: 0.875rem;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 3.5rem;
            }
            .header p {
                font-size: 1.25rem;
            }
        }

        /* Controls */
        .controls {
            max-width: 900px;
            margin: 0 auto 2.5rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
            animation: fade-in 0.8s ease-out;
            animation-delay: 0.6s;
            animation-fill-mode: backwards;
        }

        .search-input {
            flex: 1;
            padding: 0.75rem 1.25rem;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 6px;
            color: #ffffff;
            font-size: 0.9375rem;
            transition: all 0.2s ease;
            min-width: 250px;
        }

        .search-input::placeholder {
            color: #64748b;
        }

        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(255, 255, 255, 0.06);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .filter-button {
            padding: 0.75rem 1.25rem;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 6px;
            color: #ffffff;
            font-size: 0.9375rem;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            font-weight: 500;
        }

        .filter-button:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(255, 255, 255, 0.12);
            transform: translateY(-1px);
        }

        .filter-button.active {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.4);
            color: #93c5fd;
        }
        
        /* Multi-select mode */
        .multi-select-controls {
            display: none;
            gap: 1rem;
            align-items: center;
        }
        
        .multi-select-controls.active {
            display: flex;
        }
        
        .select-mode-button {
            padding: 0.75rem 1.5rem;
            background-color: #ef4444;
            border: none;
            border-radius: 0.5rem;
            color: #ffffff;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .select-mode-button:hover {
            background-color: #dc2626;
        }
        
        .hide-selected-button {
            padding: 0.75rem 1.5rem;
            background-color: #10b981;
            border: none;
            border-radius: 0.5rem;
            color: #ffffff;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .hide-selected-button:hover {
            background-color: #059669;
        }
        
        .cancel-select-button {
            padding: 0.75rem 1.5rem;
            background-color: #6b7280;
            border: none;
            border-radius: 0.5rem;
            color: #ffffff;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .cancel-select-button:hover {
            background-color: #4b5563;
        }
        
        .selected-count {
            color: #ffffff;
            font-weight: 600;
        }
        
        /* Selected cards */
        .project-card.selected {
            outline: 3px solid #ef4444;
            outline-offset: -3px;
        }
        
        .project-card.selecting {
            cursor: pointer;
        }
        
        .project-card.selecting:hover {
            outline: 3px solid rgba(239, 68, 68, 0.5);
            outline-offset: -3px;
        }

        /* Grid Gallery */
        .gallery {
            max-width: 1600px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            grid-auto-rows: 120px;
            gap: 1.5rem;
            grid-auto-flow: dense;
        }

        /* Project Cards */
        .project-card {
            background-color: #1a1a1a;
            border-radius: 1rem;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            border: 1px solid #333;
        }

        /* Card sizes - Single cells */
        .project-card.tiny { grid-row: span 1; }
        .project-card.small { grid-row: span 2; }
        .project-card.medium { grid-row: span 3; }
        
        /* Multi-cell cards */
        .project-card.tall { 
            grid-row: span 4;
            height: 100%;
        }
        
        .project-card.wide { 
            grid-column: span 2;
            grid-row: span 2;
            height: 100%;
        }
        
        .project-card.large {
            grid-column: span 2;
            grid-row: span 3;
            height: 100%;
        }
        
        .project-card.xlarge {
            grid-column: span 3;
            grid-row: span 4;
            height: 100%;
        }
        
        /* Icon cards - various sizes */
        .project-card.icon-tiny {
            grid-row: span 1;
            height: 100%;
            aspect-ratio: 1;
        }
        
        .project-card.icon-small {
            grid-row: span 2;
            height: 100%;
            aspect-ratio: 1;
        }
        
        .project-card.icon-medium { 
            grid-row: span 2;
            grid-column: span 1;
            height: 100%;
            aspect-ratio: 1;
        }
        
        .project-card.icon-large { 
            grid-row: span 3;
            grid-column: span 1;
            height: 100%;
            aspect-ratio: 1;
        }
        
        .project-card.icon-wide {
            grid-row: span 2;
            grid-column: span 2;
            height: 100%;
        }
        
        .project-card.icon-square { 
            grid-row: span 3;
            grid-column: span 3;
            height: 100%;
            aspect-ratio: 1;
        }

        /* Featured projects */
        .project-card.featured {
            grid-column: span 2;
            grid-row: span 3;
        }

        .project-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            border-color: #06b6d4;
        }

        .project-card.editing {
            outline: 3px solid #06b6d4;
        }

        /* Image Container */
        .image-container {
            width: 100%;
            position: relative;
            overflow: hidden;
            height: 100%;
        }

        /* Live iframe preview */
        .project-iframe {
            position: absolute;
            width: 400%;
            height: 400%;
            border: none;
            transform: scale(0.25);
            transform-origin: 0 0;
            pointer-events: none;
            background: #0a0a0a;
        }

        .project-screenshot {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: grab;
            transition: transform 0.3s ease;
            user-select: none;
        }

        .project-screenshot.fit-contain {
            object-fit: contain;
            padding: 1rem;
        }
        
        /* Icon-specific styling */
        .project-card.icon-square .project-screenshot {
            object-fit: cover;
            padding: 0;
            width: 100%;
            height: 100%;
        }

        .project-screenshot.fit-fill {
            object-fit: fill;
        }

        .project-card.editing .project-screenshot {
            cursor: grab;
        }

        .project-card.editing .project-screenshot.dragging {
            cursor: grabbing;
        }

        .project-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #64748b;
            font-size: 3rem;
        }

        /* Loading spinner for iframes */
        .iframe-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            color: #06b6d4;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Overlay */
        .project-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.9) 70%);
            opacity: 0;
            transition: opacity 0.3s;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            pointer-events: none;
        }

        .project-card:hover .project-overlay {
            opacity: 1;
            pointer-events: auto;
        }

        .project-card.editing .project-overlay {
            opacity: 0;
            pointer-events: none;
        }

        .project-name {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #ffffff;
            line-height: 1.3;
        }

        .project-card.large .project-name,
        .project-card.xlarge .project-name {
            font-size: 1.5rem;
        }

        .project-url {
            color: #94a3b8;
            font-size: 0.75rem;
            margin-bottom: 1rem;
            word-break: break-all;
            opacity: 0.8;
        }

        .project-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .action-button {
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
            text-decoration: none;
            backdrop-filter: blur(10px);
        }

        .action-button:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .action-button.primary {
            background: #06b6d4;
            border-color: #06b6d4;
        }

        .action-button.primary:hover {
            background: #0891b2;
        }

        .action-button.danger {
            background: #dc2626;
            border-color: #dc2626;
        }

        .action-button.danger:hover {
            background: #b91c1c;
        }

        /* Remove button */
        .remove-button {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            width: 32px;
            height: 32px;
            background: rgba(220, 38, 38, 0.9);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.25rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            z-index: 10;
        }

        .project-card:hover .remove-button {
            opacity: 1;
        }

        .remove-button:hover {
            background: rgba(185, 28, 28, 0.9);
            transform: scale(1.1);
        }

        /* Edit Panel */
        .edit-panel {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100vh;
            background: #1e1e1e;
            border-left: 1px solid #333;
            transition: right 0.3s;
            overflow-y: auto;
            z-index: 1000;
            padding: 2rem;
        }

        .edit-panel.active {
            right: 0;
        }

        .close-panel {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: #888;
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.2s;
        }

        .close-panel:hover {
            color: #fff;
        }

        .edit-group {
            margin-bottom: 1.5rem;
        }

        .edit-group label {
            display: block;
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 0.5rem;
        }

        .edit-input {
            width: 100%;
            background: #2a2a2a;
            border: 1px solid #444;
            color: #fff;
            padding: 0.75rem;
            border-radius: 6px;
            font-size: 1rem;
        }

        .zoom-slider {
            width: 100%;
            margin-top: 0.5rem;
            appearance: none;
            height: 6px;
            background: #2a2a2a;
            outline: none;
            border-radius: 3px;
        }

        .zoom-slider::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #06b6d4;
            cursor: pointer;
        }

        /* Size selector */
        .size-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            max-width: 100%;
        }

        .size-button {
            padding: 0.5rem;
            background: #2a2a2a;
            border: 1px solid #444;
            color: #fff;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .size-button:hover {
            border-color: #06b6d4;
        }

        .size-button.active {
            background: #06b6d4;
            border-color: #06b6d4;
        }

        /* Checkbox */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Refresh button */
        .refresh-button {
            padding: 0.5rem 1rem;
            background: #06b6d4;
            border: none;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
            width: 100%;
            margin-top: 1rem;
        }

        .refresh-button:hover {
            background: #0891b2;
        }

        /* Auto-size badge */
        .auto-size-badge {
            position: absolute;
            top: 0.75rem;
            left: 0.75rem;
            background: rgba(6,182,212,0.9);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .project-card:hover .auto-size-badge {
            opacity: 1;
        }

        .stats {
            text-align: center;
            margin-bottom: 2rem;
            color: #6b7280;
        }

        .stats-number {
            color: #06b6d4;
            font-weight: 700;
            font-size: 1.5rem;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: #6b7280;
        }

        /* Rounded corners */
        .project-card.rounded-corners {
            border-radius: 24px;
        }

        .project-card.rounded-corners .image-container {
            border-radius: 24px;
        }
        
        /* Debugging Tools */
        .debugging-tools {
            max-width: 1600px;
            margin: 3rem auto;
            padding: 2rem;
            background-color: #1a1a1a;
            border: 1px solid #333;
            border-radius: 1rem;
        }
        
        .debugging-tools h3 {
            color: #06b6d4;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }
        
        .debug-button {
            padding: 0.75rem 1.5rem;
            background-color: #262626;
            border: 1px solid #444;
            border-radius: 0.5rem;
            color: #ffffff;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0.5rem;
        }
        
        .debug-button:hover {
            background-color: #333;
            border-color: #06b6d4;
        }
        
        #debugInfo {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #262626;
            border-radius: 0.5rem;
            font-family: monospace;
            font-size: 0.875rem;
            color: #06b6d4;
            white-space: pre-wrap;
            display: none;
        }
        
        #debugInfo.active {
            display: block;
        }
        
        /* Debug Buttons */
        .debug-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        /* Error Dashboard */
        .error-dashboard {
            background-color: #1a1a1a;
            border-radius: 8px;
            border: 1px solid #333;
            margin-top: 1.5rem;
            display: none;
            overflow: hidden;
        }
        
        .error-dashboard.active {
            display: block;
        }
        
        .error-dashboard-header {
            padding: 1rem;
            border-bottom: 1px solid #333;
        }
        
        .error-dashboard-header h4 {
            margin: 0 0 0.75rem 0;
            font-size: 1.1rem;
            color: #06b6d4;
        }
        
        .error-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .error-stat {
            font-size: 0.85rem;
            padding: 0.25rem 0.75rem;
            background-color: #262626;
            border-radius: 12px;
            color: #94a3b8;
        }
        
        .error-dashboard-tabs {
            display: flex;
            overflow-x: auto;
            gap: 0.5rem;
            padding-bottom: 0.5rem;
        }
        
        .error-tab {
            padding: 0.5rem 1rem;
            background-color: #262626;
            border: 1px solid #444;
            border-radius: 4px;
            color: #94a3b8;
            cursor: pointer;
            font-size: 0.85rem;
            white-space: nowrap;
        }
        
        .error-tab.active {
            background-color: #06b6d4;
            color: #fff;
            border-color: #06b6d4;
        }
        
        .error-dashboard-content {
            max-height: 500px;
            overflow-y: auto;
            padding: 0.5rem;
        }
        
        .error-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .error-entry {
            background-color: #262626;
            border-radius: 6px;
            padding: 0.75rem;
            border-left: 3px solid #444;
            font-family: monospace;
            font-size: 0.85rem;
        }
        
        .error-entry.resource-missing {
            border-left-color: #eab308; /* Yellow */
        }
        
        .error-entry.api-failure {
            border-left-color: #ef4444; /* Red */
        }
        
        .error-entry.cors-error {
            border-left-color: #8b5cf6; /* Purple */
        }
        
        .error-entry.warning {
            border-left-color: #f59e0b; /* Amber */
        }
        
        .error-entry-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            color: #94a3b8;
            font-size: 0.75rem;
        }
        
        .error-source {
            max-width: 50%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .error-message {
            color: #f1f5f9;
            margin-bottom: 0.75rem;
            word-break: break-word;
        }
        
        .error-stack {
            font-size: 0.75rem;
            color: #64748b;
            white-space: pre-wrap;
            margin-bottom: 0.75rem;
            max-height: 150px;
            overflow-y: auto;
            display: none;
        }
        
        .error-stack.active {
            display: block;
        }
        
        .error-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .error-actions button {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            background-color: #333;
            border: none;
            border-radius: 4px;
            color: #94a3b8;
            cursor: pointer;
        }
        
        .error-actions button:hover {
            background-color: #444;
            color: #fff;
        }
        
        .error-copy-btn {
            background-color: #1d4ed8 !important;
            color: #fff !important;
        }
        
        .error-ignore-btn {
            background-color: #475569 !important;
        }
        
        .error-fix-btn {
            background-color: #059669 !important;
            color: #fff !important;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .gallery {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
                gap: 1rem;
            }

            .header h1 {
                font-size: 2rem;
            }

            .controls {
                gap: 0.5rem;
            }
            
            /* Adjust multi-column cards on mobile */
            .project-card.wide,
            .project-card.large,
            .project-card.xlarge {
                grid-column: span 1;
            }
            
            /* Adjust tall cards on mobile */
            .project-card.tall {
                grid-row: span 3;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="particles">
            <div class="particle" style="left: 10%; animation-delay: 0s;"></div>
            <div class="particle" style="left: 25%; animation-delay: 5s;"></div>
            <div class="particle" style="left: 40%; animation-delay: 10s;"></div>
            <div class="particle" style="left: 55%; animation-delay: 15s;"></div>
            <div class="particle" style="left: 70%; animation-delay: 20s;"></div>
            <div class="particle" style="left: 85%; animation-delay: 25s;"></div>
        </div>
        <div class="header-content">
            <h1>Project Gallery</h1>
            <p>Live previews of all deployed applications and custom app icons</p>
            <div class="header-badges">
                <div class="header-badge">
                    <svg class="header-badge-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M13 7H7v6h6V7z" />
                        <path fill-rule="evenodd" d="M7 2a1 1 0 012 0v1h2V2a1 1 0 112 0v1h2a2 2 0 012 2v2h1a1 1 0 110 2h-1v2h1a1 1 0 110 2h-1v2a2 2 0 01-2 2h-2v1a1 1 0 11-2 0v-1H9v1a1 1 0 11-2 0v-1H5a2 2 0 01-2-2v-2H2a1 1 0 110-2h1V9H2a1 1 0 010-2h1V5a2 2 0 012-2h2V2z" clip-rule="evenodd" />
                    </svg>
                    <span class="header-badge-number" id="totalBadge">0</span>
                    <span class="header-badge-label">Total</span>
                </div>
                <div class="header-badge">
                    <svg class="header-badge-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                    </svg>
                    <span class="header-badge-number" id="successBadge">0</span>
                    <span class="header-badge-label">Active</span>
                </div>
                <div class="header-badge">
                    <svg class="header-badge-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                        <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                    </svg>
                    <span class="header-badge-number" id="hiddenBadge">0</span>
                    <span class="header-badge-label">Hidden</span>
                </div>
                <div class="header-badge">
                    <svg class="header-badge-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" />
                    </svg>
                    <span class="header-badge-number" id="iconBadge">0</span>
                    <span class="header-badge-label">Icons</span>
                </div>
            </div>
        </div>
    </div>

    <div class="controls">
        <input 
            type="text" 
            class="search-input" 
            placeholder="Search projects..."
            id="searchInput"
        />
        <button class="filter-button active" id="filterAll" onclick="filterProjects('all')">All</button>
        <button class="filter-button" id="filterSuccess" onclick="filterProjects('success')">Success</button>
        <button class="filter-button" id="filterFailed" onclick="filterProjects('failed')">Failed</button>
        <button class="select-mode-button" onclick="toggleSelectMode()">Select Multiple</button>
        
        <div class="multi-select-controls" id="multiSelectControls">
            <span class="selected-count">Selected: <span id="selectedCount">0</span></span>
            <button class="hide-selected-button" onclick="hideSelected()">Hide Selected</button>
            <button class="cancel-select-button" onclick="cancelSelectMode()">Cancel</button>
        </div>
        <button class="filter-button" onclick="showHiddenProjects()">Show Hidden</button>
    </div>

    <div class="gallery" id="gallery">
        <div class="loading">Loading projects...</div>
    </div>

    <div class="edit-panel" id="editPanel">
        <button class="close-panel" onclick="closeEditPanel()">×</button>
        <h2>Edit Project Display</h2>
        <div id="editContent"></div>
    </div>
    
    <div class="debugging-tools" id="debuggingTools">
        <h3>Debugging Tools</h3>
        <div class="debug-buttons">
            <button class="debug-button" onclick="clearAllHidden()">Clear All Hidden Projects</button>
            <button class="debug-button" onclick="resetLocalStorage()">Reset All Settings</button>
            <button class="debug-button" onclick="exportSettings()">Export Settings</button>
            <button class="debug-button" onclick="toggleErrorFiltering()">Toggle Error Filtering</button>
            <button class="debug-button" onclick="toggleErrorDashboard()">Toggle Error Dashboard</button>
            <button class="debug-button" onclick="exportErrorLogs()">Export Error Logs</button>
            <button class="debug-button" onclick="clearErrorLogs()">Clear Error Logs</button>
        </div>
        <div id="debugInfo"></div>
        
        <!-- Error Dashboard -->
        <div id="errorDashboard" class="error-dashboard">
            <div class="error-dashboard-header">
                <h4>Error Collection Dashboard</h4>
                <div class="error-stats">
                    <span class="error-stat" id="totalErrorCount">0 Total</span>
                    <span class="error-stat" id="missingResourceCount">0 Missing Resources</span>
                    <span class="error-stat" id="apiFailureCount">0 API Failures</span>
                    <span class="error-stat" id="corsErrorCount">0 CORS Issues</span>
                </div>
                <div class="error-dashboard-tabs">
                    <button class="error-tab active" data-tab="all">All Errors</button>
                    <button class="error-tab" data-tab="resourceMissing">404/Missing</button>
                    <button class="error-tab" data-tab="apiFailures">API Failures</button>
                    <button class="error-tab" data-tab="corsErrors">CORS Issues</button>
                    <button class="error-tab" data-tab="iframeErrors">iFrame Errors</button>
                    <button class="error-tab" data-tab="warnings">Warnings</button>
                </div>
            </div>
            <div class="error-dashboard-content">
                <div id="errorList" class="error-list"></div>
            </div>
        </div>
    </div>
    
    <!-- Error entry template (hidden) -->
    <template id="errorEntryTemplate">
        <div class="error-entry">
            <div class="error-entry-header">
                <span class="error-source"></span>
                <span class="error-timestamp"></span>
                <span class="error-count"></span>
            </div>
            <div class="error-message"></div>
            <div class="error-stack"></div>
            <div class="error-actions">
                <button class="error-copy-btn">Copy</button>
                <button class="error-ignore-btn">Ignore</button>
                <button class="error-fix-btn">Fix</button>
            </div>
        </div>
    </template>

    <script>
        let projects = [];
        let appIcons = [];
        let hiddenProjects = [];
        let currentFilter = 'all';
        let searchTerm = '';
        let currentEditingId = null;
        let currentEditingType = null;
        let selectMode = false;
        let selectedCards = new Set();

        // Initialize project states from localStorage
        let projectStates = {};
        const savedStates = localStorage.getItem('projectStates');
        if (savedStates) {
            projectStates = JSON.parse(savedStates);
        }

        // Empty initially - user will manually hide projects
        const lockedHiddenProjects = [];
        
        // App icons will be loaded from config file
        let APP_ICONS = [];

        // Load hidden projects from localStorage or use locked defaults
        const savedHidden = localStorage.getItem('hiddenProjects');
        if (savedHidden) {
            hiddenProjects = JSON.parse(savedHidden);
        } else {
            hiddenProjects = [...lockedHiddenProjects];
            localStorage.setItem('hiddenProjects', JSON.stringify(hiddenProjects));
        }

        // Featured projects (these will get larger sizes)
        const featuredProjects = ['griffin-radcliffe', 'porfolioplus', 'mindblitz', 'administ', 'material-dashboard-react'];

        // Projects that work well with tiny size
        const tinyProjects = ['file-fuse', 'timewell', 'tango-mango', 'steroidbase'];

        // Determine optimal size based on project characteristics
        function determineOptimalSize(project) {
            const savedState = projectStates[project.name];
            if (savedState && savedState.size) {
                return savedState.size; // Use saved size preference
            }

            // Check if it's featured
            if (featuredProjects.includes(project.name)) {
                return 'large';
            }

            // Check if it's suitable for tiny
            if (tinyProjects.includes(project.name)) {
                return 'tiny';
            }

            // Randomize for variety with weighted distribution
            const sizeWeights = {
                tiny: 0.10,
                small: 0.15,
                medium: 0.20,
                tall: 0.15,
                wide: 0.15,
                large: 0.20,
                xlarge: 0.05
            };

            const random = Math.random();
            let cumulative = 0;
            
            for (const [size, weight] of Object.entries(sizeWeights)) {
                cumulative += weight;
                if (random <= cumulative) {
                    return size;
                }
            }

            return 'medium'; // fallback
        }

        // Embedded site data to avoid CORS issues
        const SITE_DATA = [
          {
            "name": "scintillating-torrone-19b562",
            "url": "https://scintillating-torrone-19b562.netlify.app",
            "screenshot": "screenshots/scintillating-torrone-19b562.png",
            "status": "success"
          },
          {
            "name": "porfolioplus",
            "url": "https://porfolioplus.netlify.app",
            "screenshot": "screenshots/porfolioplus.png",
            "status": "success"
          },
          {
            "name": "luxury-frangollo-11cf88",
            "url": "https://luxury-frangollo-11cf88.netlify.app",
            "screenshot": "screenshots/luxury-frangollo-11cf88.png",
            "status": "success"
          },
          {
            "name": "bejewelled-crostata-2737b4",
            "url": "https://bejewelled-crostata-2737b4.netlify.app",
            "screenshot": "screenshots/bejewelled-crostata-2737b4.png",
            "status": "success"
          },
          {
            "name": "material-dashboard-react",
            "url": "https://material-dashboard-react-1746753948.netlify.app",
            "screenshot": "screenshots/material-dashboard-react.png",
            "status": "success"
          },
          {
            "name": "loquacious-begonia-80c757",
            "url": "https://loquacious-begonia-80c757.netlify.app",
            "screenshot": "screenshots/loquacious-begonia-80c757.png",
            "status": "success"
          },
          {
            "name": "silly-lily-66b5e2",
            "url": "https://silly-lily-66b5e2.netlify.app",
            "screenshot": "screenshots/silly-lily-66b5e2.png",
            "status": "success"
          },
          {
            "name": "mindblitz",
            "url": "https://mindblitz.netlify.app",
            "screenshot": "screenshots/mindblitz.png",
            "status": "success"
          },
          {
            "name": "file-fuse",
            "url": "https://file-fuse.netlify.app",
            "screenshot": "screenshots/file-fuse.png",
            "status": "success"
          },
          {
            "name": "preeminent-hotteok-79f13e",
            "url": "https://preeminent-hotteok-79f13e.netlify.app",
            "screenshot": "screenshots/preeminent-hotteok-79f13e.png",
            "status": "success"
          },
          {
            "name": "magical-bubblegum-faf4ee",
            "url": "https://magical-bubblegum-faf4ee.netlify.app",
            "screenshot": "screenshots/magical-bubblegum-faf4ee.png",
            "status": "success"
          },
          {
            "name": "steady-phoenix-93bfd1",
            "url": "https://steady-phoenix-93bfd1.netlify.app",
            "screenshot": "screenshots/steady-phoenix-93bfd1.png",
            "status": "success"
          },
          {
            "name": "administ",
            "url": "https://administ.netlify.app",
            "screenshot": "screenshots/administ.png",
            "status": "success"
          },
          {
            "name": "brokenfileflattener",
            "url": "https://brokenfileflattener.netlify.app",
            "screenshot": "screenshots/brokenfileflattener.png",
            "status": "success"
          },
          {
            "name": "timewell",
            "url": "https://timewell.netlify.app",
            "screenshot": "screenshots/timewell.png",
            "status": "success"
          },
          {
            "name": "sweet-nougat-1df434",
            "url": "https://sweet-nougat-1df434.netlify.app",
            "screenshot": "screenshots/sweet-nougat-1df434.png",
            "status": "success"
          },
          {
            "name": "griffin-radcliffe-analytics",
            "url": "https://griffin-radcliffe-analytics.netlify.app",
            "screenshot": "screenshots/griffin-radcliffe-analytics.png",
            "status": "success"
          },
          {
            "name": "tango-mango",
            "url": "https://tango-mango.netlify.app",
            "screenshot": "screenshots/tango-mango.png",
            "status": "success"
          },
          {
            "name": "griffin-radcliffe",
            "url": "https://drunkonjava.com",
            "screenshot": "screenshots/griffin-radcliffe.png",
            "status": "success"
          },
          {
            "name": "myfitlifepro",
            "url": "https://myfitlifepro.netlify.app",
            "screenshot": "screenshots/myfitlifepro.png",
            "status": "success"
          },
          {
            "name": "ephemeral-alfajores-3f1147",
            "url": "https://ephemeral-alfajores-3f1147.netlify.app",
            "screenshot": "screenshots/ephemeral-alfajores-3f1147.png",
            "status": "success"
          },
          {
            "name": "tiny-youtiao-dd447a",
            "url": "https://tiny-youtiao-dd447a.netlify.app",
            "screenshot": "screenshots/tiny-youtiao-dd447a.png",
            "status": "success"
          },
          {
            "name": "adorable-empanada-10d2a4",
            "url": "https://adorable-empanada-10d2a4.netlify.app",
            "screenshot": "screenshots/adorable-empanada-10d2a4.png",
            "status": "success"
          },
          {
            "name": "melodious-bienenstitch",
            "url": "https://melodious-bienenstitch-1857e8.netlify.app",
            "screenshot": "screenshots/melodious-bienenstitch.png",
            "status": "success"
          },
          {
            "name": "ryan-maloney",
            "url": "https://ryan-maloney.netlify.app",
            "screenshot": "screenshots/ryan-maloney.png",
            "status": "success"
          },
          {
            "name": "lease-dispute-dc",
            "url": "https://lease-dispute-dc.netlify.app",
            "screenshot": "screenshots/lease-dispute-dc.png",
            "status": "success"
          },
          {
            "name": "stately-kelpie-a559bb",
            "url": "https://stately-kelpie-a559bb.netlify.app",
            "screenshot": null,
            "status": "failed",
            "error": "Screenshot failed"
          },
          {
            "name": "rococo-starburst-882bb6",
            "url": "https://rococo-starburst-882bb6.netlify.app",
            "screenshot": "screenshots/rococo-starburst-882bb6.png",
            "status": "success"
          },
          {
            "name": "bucolic-griffin-9cf2cb",
            "url": "https://bucolic-griffin-9cf2cb.netlify.app",
            "screenshot": "screenshots/bucolic-griffin-9cf2cb.png",
            "status": "success"
          },
          {
            "name": "scintillating-youtiao",
            "url": "https://scintillating-youtiao-a64c89.netlify.app",
            "screenshot": "screenshots/scintillating-youtiao.png",
            "status": "success"
          },
          {
            "name": "melodious-melba-4d2edd",
            "url": "https://melodious-melba-4d2edd.netlify.app",
            "screenshot": "screenshots/melodious-melba-4d2edd.png",
            "status": "success"
          },
          {
            "name": "thehintdropper",
            "url": "https://thehintdropper.netlify.app",
            "screenshot": "screenshots/thehintdropper.png",
            "status": "success"
          },
          {
            "name": "resonant-baklava-be6eb1",
            "url": "https://resonant-baklava-be6eb1.netlify.app",
            "screenshot": "screenshots/resonant-baklava-be6eb1.png",
            "status": "success"
          },
          {
            "name": "benevolent-flan-f2c21d",
            "url": "https://benevolent-flan-f2c21d.netlify.app",
            "screenshot": "screenshots/benevolent-flan-f2c21d.png",
            "status": "success"
          },
          {
            "name": "famous-dragon-b0cae6",
            "url": "https://famous-dragon-b0cae6.netlify.app",
            "screenshot": "screenshots/famous-dragon-b0cae6.png",
            "status": "success"
          },
          {
            "name": "jolly-mooncake-7d55df",
            "url": "https://jolly-mooncake-7d55df.netlify.app",
            "screenshot": "screenshots/jolly-mooncake-7d55df.png",
            "status": "success"
          },
          {
            "name": "friendly-daifuku-78fd5b",
            "url": "https://friendly-daifuku-78fd5b.netlify.app",
            "screenshot": "screenshots/friendly-daifuku-78fd5b.png",
            "status": "success"
          },
          {
            "name": "bejewelled-kataifi-88b1d9",
            "url": "https://bejewelled-kataifi-88b1d9.netlify.app",
            "screenshot": "screenshots/bejewelled-kataifi-88b1d9.png",
            "status": "success"
          },
          {
            "name": "steroidbase",
            "url": "https://steroidbase.netlify.app",
            "screenshot": "screenshots/steroidbase.png",
            "status": "success"
          },
          {
            "name": "coruscating-cat-3a8117",
            "url": "https://coruscating-cat-3a8117.netlify.app",
            "screenshot": "screenshots/coruscating-cat-3a8117.png",
            "status": "success"
          },
          {
            "name": "remarkable-arithmetic",
            "url": "https://remarkable-arithmetic-edf3e0.netlify.app",
            "screenshot": "screenshots/remarkable-arithmetic.png",
            "status": "success"
          },
          {
            "name": "macostoolbox",
            "url": "https://macostoolbox.netlify.app",
            "screenshot": "screenshots/macostoolbox.png",
            "status": "success"
          },
          {
            "name": "unrivaled-douhua-5f6118",
            "url": "https://unrivaled-douhua-5f6118.netlify.app",
            "screenshot": "screenshots/unrivaled-douhua-5f6118.png",
            "status": "success"
          },
          {
            "name": "steroid-guide",
            "url": "https://steroid-guide.netlify.app",
            "screenshot": "screenshots/steroid-guide.png",
            "status": "success"
          },
          {
            "name": "clinquant-custard-ea9541",
            "url": "https://clinquant-custard-ea9541.netlify.app",
            "screenshot": "screenshots/clinquant-custard-ea9541.png",
            "status": "success"
          },
          {
            "name": "zingy-griffin-2aaa95",
            "url": "https://zingy-griffin-2aaa95.netlify.app",
            "screenshot": "screenshots/zingy-griffin-2aaa95.png",
            "status": "success"
          },
          {
            "name": "uiplaygrounddemure",
            "url": "https://uiplaygrounddemure.netlify.app",
            "screenshot": "screenshots/uiplaygrounddemure.png",
            "status": "success"
          },
          {
            "name": "effulgent-banoffee-0066a0",
            "url": "https://effulgent-banoffee-0066a0.netlify.app",
            "screenshot": "screenshots/effulgent-banoffee-0066a0.png",
            "status": "success"
          },
          {
            "name": "homebaseboard",
            "url": "https://homebaseboard.netlify.app",
            "screenshot": "screenshots/homebaseboard.png",
            "status": "success"
          },
          {
            "name": "extraordinary-chimera",
            "url": "https://extraordinary-chimera-4ff070.netlify.app",
            "screenshot": "screenshots/extraordinary-chimera.png",
            "status": "success"
          },
          {
            "name": "funny-fenglisu-88d17f",
            "url": "https://funny-fenglisu-88d17f.netlify.app",
            "screenshot": "screenshots/funny-fenglisu-88d17f.png",
            "status": "success"
          },
          {
            "name": "eclectic-sundae-039c2a",
            "url": "https://eclectic-sundae-039c2a.netlify.app",
            "screenshot": "screenshots/eclectic-sundae-039c2a.png",
            "status": "success"
          },
          {
            "name": "delicate-queijadas-815906",
            "url": "https://delicate-queijadas-815906.netlify.app",
            "screenshot": "screenshots/delicate-queijadas-815906.png",
            "status": "success"
          },
          {
            "name": "tiny-licorice-ce088d",
            "url": "https://tiny-licorice-ce088d.netlify.app",
            "screenshot": "screenshots/tiny-licorice-ce088d.png",
            "status": "success"
          },
          {
            "name": "chimerical-elf-43064a",
            "url": "https://chimerical-elf-43064a.netlify.app",
            "screenshot": "screenshots/chimerical-elf-43064a.png",
            "status": "success"
          }
        ];

        // Load project data
        async function loadProjects() {
            try {
                // Fetch the site data from the JSON file
                const response = await fetch('site-data.json');
                if (!response.ok) {
                    throw new Error(`Failed to fetch site data: ${response.status} ${response.statusText}`);
                }
                const data = await response.json();
                
                // Filter out hidden projects and merge with saved states
                projects = data
                    .filter(project => !hiddenProjects.includes(project.name))
                    .map(project => {
                        const savedState = projectStates[project.name] || {};
                        const optimalSize = determineOptimalSize(project);
                        
                        return {
                            ...project,
                            size: savedState.size || optimalSize,
                            roundedCorners: savedState.roundedCorners || false,
                            featured: featuredProjects.includes(project.name),
                            useLivePreview: savedState.useLivePreview !== false // Default to true
                        };
                    });
                
                updateStats();
                renderGallery();
                // Load icons after projects
                loadAppIcons();
            } catch (error) {
                console.error('Error loading projects:', error);
                document.getElementById('gallery').innerHTML = '<div class="loading">Error loading projects: ' + error.message + '</div>';
                document.getElementById('debugInfo').textContent = `Error loading projects: ${error.message}`;
                document.getElementById('debugInfo').classList.add('active');
                
                // Fallback to embedded data if fetch fails
                if (typeof SITE_DATA !== 'undefined') {
                    console.log('Falling back to embedded site data');
                    projects = SITE_DATA
                        .filter(project => !hiddenProjects.includes(project.name))
                        .map(project => {
                            const savedState = projectStates[project.name] || {};
                            const optimalSize = determineOptimalSize(project);
                            
                            return {
                                ...project,
                                size: savedState.size || optimalSize,
                                roundedCorners: savedState.roundedCorners || false,
                                featured: featuredProjects.includes(project.name),
                                useLivePreview: savedState.useLivePreview !== false
                            };
                        });
                    
                    updateStats();
                    renderGallery();
                    loadAppIcons();
                }
                
                // Hide debug info after 5 seconds
                setTimeout(() => {
                    document.getElementById('debugInfo').classList.remove('active');
                }, 5000);
            }
        }

        function updateStats() {
            const total = projects.length + hiddenProjects.length + appIcons.length;
            const hidden = hiddenProjects.length;
            const successCount = projects.filter(p => p.status === 'success').length;
            const iconCount = appIcons.length;
            
            // Update header badges
            document.getElementById('totalBadge').textContent = total;
            document.getElementById('successBadge').textContent = successCount;
            document.getElementById('hiddenBadge').textContent = hidden;
            document.getElementById('iconBadge').textContent = iconCount;
            
            // Update old stats (if they still exist)
            const totalCountEl = document.getElementById('totalCount');
            const hiddenCountEl = document.getElementById('hiddenCount');
            if (totalCountEl) totalCountEl.textContent = total;
            if (hiddenCountEl) hiddenCountEl.textContent = hidden;
        }

        function saveProjectState(projectName, state) {
            projectStates[projectName] = state;
            localStorage.setItem('projectStates', JSON.stringify(projectStates));
        }

        function saveHiddenProjects() {
            localStorage.setItem('hiddenProjects', JSON.stringify(hiddenProjects));
        }

        function removeProject(projectName) {
            if (confirm(`Remove ${projectName} from gallery?`)) {
                hiddenProjects.push(projectName);
                saveHiddenProjects();
                projects = projects.filter(p => p.name !== projectName);
                updateStats();
                renderGallery();
            }
        }

        function filterProjects(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`filter${filter.charAt(0).toUpperCase() + filter.slice(1)}`).classList.add('active');
            renderGallery();
        }
        
        // Load app icons from config file
        async function loadAppIcons() {
            try {
                // Load icons configuration
                const response = await fetch('icons-config.json');
                if (!response.ok) {
                    throw new Error(`Failed to fetch icons config: ${response.status} ${response.statusText}`);
                }
                const config = await response.json();
                APP_ICONS = config.icons;
                
                // Process icons
                appIcons = APP_ICONS.map(icon => {
                    const savedState = projectStates[icon.name] || {};
                    return {
                        ...icon,
                        type: 'icon',
                        size: savedState.size || 'icon-square',
                        roundedCorners: savedState.roundedCorners !== false, // Default to true for icons
                        screenshot: `app-icons/${icon.name}.png`,
                    };
                });
                updateStats();
                renderGallery();
            } catch (error) {
                console.error('Error loading app icons:', error);
                document.getElementById('debugInfo').textContent = `Error loading app icons: ${error.message}`;
                document.getElementById('debugInfo').classList.add('active');
                
                // Fall back to embedded icons if config fails
                APP_ICONS = [
                    { name: 'app-icon-1', displayName: 'App Icon 1' },
                    { name: 'app-icon-2', displayName: 'App Icon 2' },
                    { name: 'app-icon-3', displayName: 'App Icon 3' },
                    { name: 'file-creator', displayName: 'File Creator' },
                    { name: 'drunk-on-java', displayName: 'Drunk On Java' },
                    { name: 'app-icon-4', displayName: 'App Icon 4' },
                    { name: 'file-fuse', displayName: 'File Fuse' },
                    { name: 'gpt4o', displayName: 'GPT-4o Assistant' },
                    { name: 'hammer', displayName: 'Hammer Tools' },
                    { name: 'mindblitz', displayName: 'MindBlitz' },
                    { name: 'minimalist', displayName: 'Minimalist' },
                    { name: 'template', displayName: 'Template' },
                    { name: 'xcode-vscode-1', displayName: 'Xcode VS Code 1' },
                    { name: 'xcode-vscode-2', displayName: 'Xcode VS Code 2' },
                    { name: 'xcode-vscode-3', displayName: 'Xcode VS Code 3' }
                ];
                appIcons = APP_ICONS.map(icon => {
                    const savedState = projectStates[icon.name] || {};
                    return {
                        ...icon,
                        type: 'icon',
                        size: savedState.size || 'icon-square',
                        roundedCorners: savedState.roundedCorners !== false,
                        screenshot: `app-icons/${icon.name}.png`,
                    };
                });
                updateStats();
                renderGallery();
                
                // Hide debug info after 5 seconds
                setTimeout(() => {
                    document.getElementById('debugInfo').classList.remove('active');
                }, 5000);
            }
        }

        function renderGallery() {
            const gallery = document.getElementById('gallery');
            searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            let filteredProjects = projects;
            let filteredIcons = appIcons;
            
            // Apply status filter (only for projects, not icons)
            if (currentFilter === 'success') {
                filteredProjects = filteredProjects.filter(p => p.status === 'success');
            } else if (currentFilter === 'failed') {
                filteredProjects = filteredProjects.filter(p => p.status === 'failed');
            }
            
            // Apply search filter
            if (searchTerm) {
                filteredProjects = filteredProjects.filter(p => 
                    p.name.toLowerCase().includes(searchTerm) ||
                    p.url.toLowerCase().includes(searchTerm)
                );
                filteredIcons = filteredIcons.filter(i => 
                    i.name.toLowerCase().includes(searchTerm) ||
                    i.displayName.toLowerCase().includes(searchTerm)
                );
            }
            
            // Combine projects and icons
            let allItems = [...filteredProjects, ...filteredIcons];
            
            // Sort to put projects first (featured at top), then icons
            allItems.sort((a, b) => {
                // Projects before icons
                if (!a.type && b.type === 'icon') return -1;
                if (a.type === 'icon' && !b.type) return 1;
                
                // Among projects, featured first
                if (!a.type && !b.type) {
                    if (a.featured && !b.featured) return -1;
                    if (!a.featured && b.featured) return 1;
                    const sizeOrder = { xlarge: 0, large: 1, medium: 2, small: 3, tiny: 4 };
                    return sizeOrder[a.size] - sizeOrder[b.size];
                }
                
                return 0;
            });
            
            if (allItems.length === 0) {
                gallery.innerHTML = '<div class="loading">No items found</div>';
                return;
            }
            
            gallery.innerHTML = allItems.map((item, index) => {
                if (item.type === 'icon') {
                    return `
                        <div class="project-card ${item.size} ${item.roundedCorners ? 'rounded-corners' : ''} ${currentEditingId === item.name ? 'editing' : ''} ${selectMode ? 'selecting' : ''} ${selectedCards.has(item.name) ? 'selected' : ''}" 
                             id="card-${index}"
                             onclick="${selectMode ? `toggleCardSelection('${item.name}')` : ''}">
                            <button class="remove-button" onclick="event.stopPropagation(); removeItem('${item.name}', 'icon')" title="Remove from gallery">×</button>
                            <div class="image-container">
                                <img 
                                    src="${item.screenshot}" 
                                    alt="${item.displayName}" 
                                    class="project-screenshot"
                                    id="img-${index}"
                                    loading="lazy"
                                    onerror="this.onerror=null; handleIconImageError(this, '${item.displayName}')"
                                />
                                <div class="auto-size-badge">ICON</div>
                            </div>
                            <div class="project-overlay" style="${selectMode ? 'pointer-events: none;' : ''}">
                                <h3 class="project-name">${item.displayName}</h3>
                                <div class="project-actions">
                                    <button class="action-button" onclick="event.stopPropagation(); openEditPanel('${item.name}', 'icon')">Edit</button>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="project-card ${item.size} ${item.featured ? 'featured' : ''} ${item.roundedCorners ? 'rounded-corners' : ''} ${currentEditingId === item.name ? 'editing' : ''} ${selectMode ? 'selecting' : ''} ${selectedCards.has(item.name) ? 'selected' : ''}" 
                             id="card-${index}"
                             onclick="${selectMode ? `toggleCardSelection('${item.name}')` : ''}">
                            <button class="remove-button" onclick="event.stopPropagation(); removeProject('${item.name}')" title="Remove from gallery">×</button>
                            <div class="image-container">
                                ${item.useLivePreview && item.status === 'success' ? 
                                    `<div class="iframe-loading">⟳</div>
                                     <iframe 
                                        src="${item.url}" 
                                        class="project-iframe"
                                        id="iframe-${index}"
                                        onload="this.previousElementSibling.style.display='none'; this.style.opacity=1;"
                                        onerror="handleIframeError(this, '${item.name}')"
                                        sandbox="allow-scripts allow-same-origin allow-popups"
                                        loading="lazy"
                                        style="opacity: 0; transition: opacity 0.3s ease;"
                                    ></iframe>` :
                                    item.screenshot && item.status === 'success' ? 
                                        `<img 
                                            src="${item.screenshot}" 
                                            alt="${item.name}" 
                                            class="project-screenshot"
                                            id="img-${index}"
                                            loading="lazy"
                                            onerror="this.onerror=null; handleImageError(this, '${item.name}', '${item.url}')"
                                            onclick="if (!currentEditingId && !selectMode) window.open('${item.url}', '_blank')"
                                        >` :
                                        `<div class="project-placeholder">📁</div>`
                                }
                                <div class="auto-size-badge">${item.size.toUpperCase()}</div>
                            </div>
                            <div class="project-overlay" style="${selectMode ? 'pointer-events: none;' : ''}">
                                <h3 class="project-name">${item.name}</h3>
                                <p class="project-url">${item.url}</p>
                                <div class="project-actions">
                                    <a href="${item.url}" target="_blank" class="action-button primary" onclick="event.stopPropagation()">Visit Site</a>
                                    <button class="action-button" onclick="event.stopPropagation(); openEditPanel('${item.name}')">Edit</button>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }).join('');
        }

        // Remove icon
        function removeItem(itemName, type) {
            if (confirm(`Remove ${itemName} from gallery?`)) {
                if (type === 'icon') {
                    appIcons = appIcons.filter(i => i.name !== itemName);
                } else {
                    hiddenProjects.push(itemName);
                    saveHiddenProjects();
                    projects = projects.filter(p => p.name !== itemName);
                }
                updateStats();
                renderGallery();
            }
        }

        // Open edit panel
        function openEditPanel(itemName, type = 'project') {
            currentEditingId = itemName;
            currentEditingType = type;
            document.getElementById('editPanel').classList.add('active');
            renderGallery();
            renderEditForm();
        }

        // Close edit panel
        function closeEditPanel() {
            document.getElementById('editPanel').classList.remove('active');
            currentEditingId = null;
            renderGallery();
        }

        // Render edit form
        function renderEditForm() {
            let item;
            let sizeOptions;
            
            if (currentEditingType === 'icon') {
                item = appIcons.find(i => i.name === currentEditingId);
                sizeOptions = ['icon-tiny', 'icon-small', 'icon-medium', 'icon-large', 'icon-wide', 'icon-square'];
            } else {
                item = projects.find(p => p.name === currentEditingId);
                sizeOptions = ['tiny', 'small', 'medium', 'tall', 'wide', 'large', 'xlarge'];
            }
            
            if (!item) return;
            
            const editContent = document.getElementById('editContent');
            
            editContent.innerHTML = `
                <div class="edit-group">
                    <label>${currentEditingType === 'icon' ? 'Icon' : 'Project'} Name</label>
                    <div class="edit-input" style="cursor: default;">${item.displayName || item.name}</div>
                </div>
                
                ${currentEditingType !== 'icon' ? `
                <div class="edit-group">
                    <label>Project URL</label>
                    <div class="edit-input" style="cursor: default;">${item.url}</div>
                </div>` : ''}
                
                <div class="edit-group">
                    <label>Card Size</label>
                    <div class="size-selector">
                        ${sizeOptions.map(size => 
                            `<button class="size-button ${item.size === size ? 'active' : ''}" 
                                     onclick="updateItem('size', '${size}')">${formatSizeName(size)}</button>`
                        ).join('')}
                    </div>
                </div>
                
                ${currentEditingType !== 'icon' ? `
                <div class="edit-group">
                    <div class="checkbox-group">
                        <input type="checkbox" 
                               id="livePreview"
                               ${item.useLivePreview ? 'checked' : ''}
                               onchange="updateItem('useLivePreview', this.checked)">
                        <label for="livePreview">Use Live Preview</label>
                    </div>
                </div>` : ''}
                
                <div class="edit-group">
                    <div class="checkbox-group">
                        <input type="checkbox" 
                               id="roundedCorners"
                               ${item.roundedCorners ? 'checked' : ''}
                               onchange="updateItem('roundedCorners', this.checked)">
                        <label for="roundedCorners">Rounded Corners</label>
                    </div>
                </div>
                
                ${item.useLivePreview && currentEditingType !== 'icon' ? `
                    <button class="refresh-button" onclick="refreshIframe('${item.name}')">
                        Refresh Preview
                    </button>
                ` : ''}
            `;
        }

        // Format size name for display
        function formatSizeName(size) {
            // Convert hyphenated names to space-separated and capitalize first letter
            const formatted = size.replace(/-/g, ' ').replace(/^\w/, c => c.toUpperCase());
            return formatted;
        }

        // Update item
        function updateItem(field, value) {
            let item;
            
            if (currentEditingType === 'icon') {
                item = appIcons.find(i => i.name === currentEditingId);
            } else {
                item = projects.find(p => p.name === currentEditingId);
            }
            
            if (!item) return;
            
            item[field] = value;
            
            saveProjectState(item.name, {
                size: item.size,
                roundedCorners: item.roundedCorners,
                useLivePreview: item.useLivePreview
            });
            
            renderGallery();
            renderEditForm();
        }

        // Refresh iframe
        function refreshIframe(projectName) {
            const project = projects.find(p => p.name === projectName);
            const index = projects.indexOf(project);
            const iframe = document.getElementById(`iframe-${index}`);
            if (iframe) {
                iframe.src = iframe.src;
            }
        }

        // Search input event
        document.getElementById('searchInput')?.addEventListener('input', renderGallery);

        // Initialize
        async function initialize() {
            await loadProjects();
        }
        
        // Error collection and console filtering
        (function() {
            // Error collection storage
            window.errorCollection = {
                errors: [],
                warnings: [],
                iframeErrors: [],
                apiFailures: [],
                resourceMissing: [],
                corsErrors: [],
                unknownErrors: [],
                maxEntries: 1000, // Maximum number of entries per category
                
                // Add error to collection
                addError: function(message, source, timestamp = new Date().toISOString(), stack = null) {
                    // Categorize the error
                    if (message.includes('404') || message.includes('Not Found')) {
                        this.addToCategory('resourceMissing', { message, source, timestamp, stack });
                    } else if (message.includes('CORS') || message.includes('Access-Control-Allow-Origin')) {
                        this.addToCategory('corsErrors', { message, source, timestamp, stack });
                    } else if (message.includes('net::ERR') || message.includes('Failed to fetch') || 
                               message.includes('401') || message.includes('Unauthorized') ||
                               message.includes('API')) {
                        this.addToCategory('apiFailures', { message, source, timestamp, stack });
                    } else if (source && source.includes('iframe')) {
                        this.addToCategory('iframeErrors', { message, source, timestamp, stack });
                    } else {
                        this.addToCategory('errors', { message, source, timestamp, stack });
                    }
                },
                
                // Add warning to collection
                addWarning: function(message, source, timestamp = new Date().toISOString()) {
                    this.addToCategory('warnings', { message, source, timestamp });
                },
                
                // Add to a specific category with limit check
                addToCategory: function(category, entry) {
                    if (!this[category]) {
                        this[category] = [];
                    }
                    
                    // Check if this exact error already exists
                    const isDuplicate = this[category].some(item => 
                        item.message === entry.message && item.source === entry.source
                    );
                    
                    if (!isDuplicate) {
                        // Limit the number of entries per category
                        if (this[category].length >= this.maxEntries) {
                            this[category].pop(); // Remove oldest
                        }
                        this[category].unshift(entry); // Add to beginning
                    } else {
                        // Update timestamp for existing entry
                        const existingEntry = this[category].find(item => 
                            item.message === entry.message && item.source === entry.source
                        );
                        if (existingEntry) {
                            existingEntry.timestamp = entry.timestamp;
                            existingEntry.count = (existingEntry.count || 1) + 1;
                        }
                    }
                },
                
                // Get all errors in formatted JSON
                getErrorsAsJson: function() {
                    return JSON.stringify({
                        timestamp: new Date().toISOString(),
                        summary: {
                            total: this.getTotalCount(),
                            errors: this.errors.length,
                            warnings: this.warnings.length,
                            iframeErrors: this.iframeErrors.length,
                            apiFailures: this.apiFailures.length,
                            resourceMissing: this.resourceMissing.length,
                            corsErrors: this.corsErrors.length,
                            unknownErrors: this.unknownErrors.length
                        },
                        categories: {
                            errors: this.errors,
                            warnings: this.warnings,
                            iframeErrors: this.iframeErrors,
                            apiFailures: this.apiFailures, 
                            resourceMissing: this.resourceMissing,
                            corsErrors: this.corsErrors,
                            unknownErrors: this.unknownErrors
                        }
                    }, null, 2);
                },
                
                // Get total error count
                getTotalCount: function() {
                    return this.errors.length + 
                           this.warnings.length + 
                           this.iframeErrors.length + 
                           this.apiFailures.length + 
                           this.resourceMissing.length + 
                           this.corsErrors.length + 
                           this.unknownErrors.length;
                },
                
                // Clear all errors
                clearAll: function() {
                    this.errors = [];
                    this.warnings = [];
                    this.iframeErrors = [];
                    this.apiFailures = [];
                    this.resourceMissing = [];
                    this.corsErrors = [];
                    this.unknownErrors = [];
                    return 'All error logs cleared';
                }
            };
            
            // Store original console methods
            const originalConsoleError = console.error;
            const originalConsoleWarn = console.warn;
            
            // Variables to control filtering
            let isErrorFilteringEnabled = true;
            
            // Make filtering state accessible globally
            window.errorFilteringState = {
                enabled: true,
                toggleFiltering: function() {
                    isErrorFilteringEnabled = !isErrorFilteringEnabled;
                    window.errorFilteringState.enabled = isErrorFilteringEnabled;
                    return isErrorFilteringEnabled;
                }
            };
            
            // Get iframe source information
            function getIframeSource(errorText) {
                // Extract URL from error message if possible
                const urlMatch = errorText.match(/https?:\/\/[^\s"')]+/g);
                if (urlMatch && urlMatch.length > 0) {
                    return urlMatch[0];
                }
                
                // Try to find an iframe reference
                for (const src of Object.keys(window.loadedIframeSources || {})) {
                    if (errorText.includes(src)) {
                        return src;
                    }
                }
                
                return 'unknown-iframe';
            }
            
            // Override console.error
            console.error = function() {
                const args = Array.from(arguments);
                const errorText = args.join(' ');
                let source = 'console.error';
                let shouldCollect = true;
                
                // Determine source based on error text
                if (errorText.includes('http')) {
                    source = getIframeSource(errorText);
                }
                
                // Handle different error types
                if (errorText.includes('chrome-extension://') || 
                    errorText.includes('extension.js') || 
                    errorText.includes('extension/') ||
                    errorText.includes('extensionState.js') ||
                    errorText.includes('completion_list.html')) {
                    // Chrome extension errors - don't collect or display
                    shouldCollect = false;
                    if (isErrorFilteringEnabled) {
                        return; // Don't pass through
                    }
                } else if (errorText.includes('ERR_NAME_NOT_RESOLVED') ||
                           errorText.includes('Failed to fetch') ||
                           errorText.includes('NetworkError') ||
                           errorText.includes('net::ERR') ||
                           errorText.includes('401 (Unauthorized)') ||
                           errorText.includes('404 (Not Found)') ||
                           errorText.includes('API key') ||
                           errorText.includes('blocked by CORS')) {
                    // API and resource errors - collect but maybe don't display
                    window.errorCollection.addError(errorText, source);
                    if (isErrorFilteringEnabled) {
                        console.log('[Embedded site API error - suppressed]');
                        return;
                    }
                }
                
                // Collect other errors
                if (shouldCollect) {
                    window.errorCollection.addError(errorText, source);
                }
                
                // Pass through all other errors
                originalConsoleError.apply(console, args);
            };
            
            // Override console.warn
            console.warn = function() {
                const args = Array.from(arguments);
                const warnText = args.join(' ');
                let source = 'console.warn';
                let shouldCollect = true;
                
                // Determine source based on warning text
                if (warnText.includes('http')) {
                    source = getIframeSource(warnText);
                }
                
                // Filter and collect warnings
                if (warnText.includes('chrome-extension://') || 
                    warnText.includes('extension.js') ||
                    warnText.includes('extension/') ||
                    warnText.includes('The message port closed')) {
                    // Extension warnings - don't collect or display
                    shouldCollect = false;
                    if (isErrorFilteringEnabled) {
                        return; // Don't pass through
                    }
                } else if (warnText.includes('Blocked autofocusing') ||
                           warnText.includes('sandbox') ||
                           warnText.includes('frame')) {
                    // Iframe warnings - collect but maybe don't display
                    window.errorCollection.addWarning(warnText, source);
                    if (isErrorFilteringEnabled) {
                        return; // Don't pass through
                    }
                }
                
                // Collect other warnings
                if (shouldCollect) {
                    window.errorCollection.addWarning(warnText, source);
                }
                
                // Pass through all other warnings
                originalConsoleWarn.apply(console, args);
            };
            
            // Track iframe sources that are loaded
            window.loadedIframeSources = {};
            
            // Handle errors from iframes
            window.addEventListener('error', function(e) {
                // Collect the error
                if (e.target && (e.target.tagName === 'IFRAME' || e.target.nodeName === 'IFRAME')) {
                    const source = e.target.src || 'unknown-iframe';
                    window.loadedIframeSources[source] = true;
                    window.errorCollection.addError(
                        e.message || 'Iframe error',
                        source,
                        new Date().toISOString(),
                        e.error?.stack || null
                    );
                    
                    // Only filter if enabled
                    if (isErrorFilteringEnabled) {
                        console.log('[Embedded site error suppressed]');
                        e.preventDefault();
                        e.stopPropagation();
                        return false;
                    }
                }
            }, true); // Capture phase
            
            // Track iframe loads for better source attribution
            document.addEventListener('DOMContentLoaded', function() {
                setInterval(() => {
                    const iframes = document.querySelectorAll('iframe');
                    iframes.forEach(iframe => {
                        if (iframe.src) {
                            window.loadedIframeSources[iframe.src] = true;
                        }
                    });
                }, 2000);
            });
            
            // Suppress unhandled promise rejections from iframes
            window.addEventListener('unhandledrejection', function(e) {
                // Check if the rejection is from an iframe resource
                if (e.reason) {
                    let source = 'unhandled-promise';
                    let message = 'Unknown promise rejection';
                    
                    if (typeof e.reason === 'string') {
                        message = e.reason;
                    } else if (e.reason.message) {
                        message = e.reason.message;
                        
                        // Try to determine source
                        if (e.reason.stack && e.reason.stack.includes('http')) {
                            const stackLines = e.reason.stack.split('\n');
                            for (const line of stackLines) {
                                if (line.includes('http')) {
                                    const match = line.match(/https?:\/\/[^\s"')]+/g);
                                    if (match && match.length) {
                                        source = match[0];
                                        break;
                                    }
                                }
                            }
                        }
                    }
                    
                    // Collect the error
                    window.errorCollection.addError(
                        message,
                        source,
                        new Date().toISOString(),
                        e.reason.stack || null
                    );
                    
                    // Only filter if enabled
                    if (isErrorFilteringEnabled) {
                        if ((e.reason.message && e.reason.message.includes('http')) ||
                            (e.reason.stack && e.reason.stack.includes('http'))) {
                            console.log('[Embedded site promise rejection suppressed]');
                            e.preventDefault();
                            e.stopPropagation();
                            return false;
                        }
                    }
                }
            });
        })();
        
        // Toggle error filtering
        function toggleErrorFiltering() {
            const enabled = window.errorFilteringState.toggleFiltering();
            showDebugInfo(`Error filtering ${enabled ? 'enabled' : 'disabled'}`);
        }
        
        // Toggle error dashboard
        function toggleErrorDashboard() {
            const dashboard = document.getElementById('errorDashboard');
            dashboard.classList.toggle('active');
            
            if (dashboard.classList.contains('active')) {
                updateErrorDashboard();
                // Set up auto-refresh
                if (!window.errorDashboardInterval) {
                    window.errorDashboardInterval = setInterval(updateErrorDashboard, 5000);
                }
            } else {
                // Clear auto-refresh
                if (window.errorDashboardInterval) {
                    clearInterval(window.errorDashboardInterval);
                    window.errorDashboardInterval = null;
                }
            }
        }
        
        // Update error dashboard with current error data
        function updateErrorDashboard() {
            // Update stats
            document.getElementById('totalErrorCount').textContent = `${window.errorCollection.getTotalCount()} Total`;
            document.getElementById('missingResourceCount').textContent = `${window.errorCollection.resourceMissing?.length || 0} Missing Resources`;
            document.getElementById('apiFailureCount').textContent = `${window.errorCollection.apiFailures?.length || 0} API Failures`;
            document.getElementById('corsErrorCount').textContent = `${window.errorCollection.corsErrors?.length || 0} CORS Issues`;
            
            // Get active tab
            const activeTab = document.querySelector('.error-tab.active');
            const tabName = activeTab ? activeTab.dataset.tab : 'all';
            
            // Render errors based on tab
            renderErrorList(tabName);
        }
        
        // Switch tabs in error dashboard
        document.addEventListener('DOMContentLoaded', function() {
            const tabs = document.querySelectorAll('.error-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    tabs.forEach(t => t.classList.remove('active'));
                    // Add active class to clicked tab
                    this.classList.add('active');
                    // Render error list for this tab
                    renderErrorList(this.dataset.tab);
                });
            });
        });
        
        // Render error list based on selected category
        function renderErrorList(category) {
            const errorList = document.getElementById('errorList');
            errorList.innerHTML = '';
            
            let errors = [];
            
            // Get errors based on category
            if (category === 'all') {
                // Combine all categories, prioritizing 404s and CORS errors
                errors = [
                    ...(window.errorCollection.resourceMissing || []),
                    ...(window.errorCollection.corsErrors || []),
                    ...(window.errorCollection.apiFailures || []),
                    ...(window.errorCollection.iframeErrors || []),
                    ...(window.errorCollection.errors || []),
                    ...(window.errorCollection.warnings || [])
                ];
            } else {
                errors = window.errorCollection[category] || [];
            }
            
            if (errors.length === 0) {
                errorList.innerHTML = '<div class="no-errors">No errors in this category</div>';
                return;
            }
            
            // Render each error
            const template = document.getElementById('errorEntryTemplate');
            errors.forEach((error, index) => {
                const clone = template.content.cloneNode(true);
                
                // Set CSS class based on type
                const entry = clone.querySelector('.error-entry');
                if (window.errorCollection.resourceMissing?.includes(error)) {
                    entry.classList.add('resource-missing');
                } else if (window.errorCollection.apiFailures?.includes(error)) {
                    entry.classList.add('api-failure');
                } else if (window.errorCollection.corsErrors?.includes(error)) {
                    entry.classList.add('cors-error');
                } else if (window.errorCollection.warnings?.includes(error)) {
                    entry.classList.add('warning');
                }
                
                // Set error data
                clone.querySelector('.error-source').textContent = error.source || 'Unknown';
                clone.querySelector('.error-timestamp').textContent = new Date(error.timestamp).toLocaleTimeString();
                
                if (error.count && error.count > 1) {
                    clone.querySelector('.error-count').textContent = `${error.count}x`;
                }
                
                clone.querySelector('.error-message').textContent = error.message;
                
                // Add stack trace if available
                const stackEl = clone.querySelector('.error-stack');
                if (error.stack) {
                    stackEl.textContent = error.stack;
                    
                    // Add click to toggle stack trace
                    clone.querySelector('.error-message').style.cursor = 'pointer';
                    clone.querySelector('.error-message').addEventListener('click', function() {
                        stackEl.classList.toggle('active');
                    });
                }
                
                // Set up action buttons
                clone.querySelector('.error-copy-btn').addEventListener('click', function() {
                    const fullError = `${error.message}\nSource: ${error.source}\nTimestamp: ${error.timestamp}${error.stack ? '\nStack: ' + error.stack : ''}`;
                    navigator.clipboard.writeText(fullError);
                    showDebugInfo('Error copied to clipboard');
                });
                
                clone.querySelector('.error-ignore-btn').addEventListener('click', function() {
                    // Add to ignored errors
                    if (!window.errorCollection.ignoredErrors) {
                        window.errorCollection.ignoredErrors = [];
                    }
                    window.errorCollection.ignoredErrors.push({
                        source: error.source,
                        message: error.message
                    });
                    
                    // Remove from collection
                    const categories = ['errors', 'warnings', 'iframeErrors', 'apiFailures', 'resourceMissing', 'corsErrors'];
                    categories.forEach(cat => {
                        if (window.errorCollection[cat]) {
                            window.errorCollection[cat] = window.errorCollection[cat].filter(e => 
                                e.message !== error.message || e.source !== error.source
                            );
                        }
                    });
                    
                    // Update dashboard
                    updateErrorDashboard();
                    showDebugInfo(`Error from ${error.source} ignored`);
                });
                
                clone.querySelector('.error-fix-btn').addEventListener('click', function() {
                    // Generate fix instructions
                    const errorUrl = error.source;
                    const instructions = generateFixInstructions(error);
                    
                    // Show in debug info
                    showDebugInfo(instructions);
                    
                    // Copy to clipboard
                    navigator.clipboard.writeText(instructions);
                    alert('Fix instructions copied to clipboard');
                });
                
                errorList.appendChild(clone);
            });
        }
        
        // Generate instructions for fixing errors
        function generateFixInstructions(error) {
            const source = error.source;
            const message = error.message;
            let instructions = "";
            
            // 404 errors for images
            if ((message.includes('404') || message.includes('Not Found')) && 
                (message.includes('.png') || message.includes('.jpg') || message.includes('.svg'))) {
                const fileName = message.match(/\/([^\/]+\.(png|jpg|svg))/i);
                if (fileName) {
                    instructions = `
Fix for 404 (Not Found) error on image: ${fileName[1]}
Site: ${source}

Edit the site's repository:
1. Add the missing image file to the images or assets directory
2. If this is a demo site, create a placeholder image:
   - Create a new file in the repository: public/images/${fileName[1]}
   - Use a placeholder service or create a basic SVG image

Example HTML fix:
<img src="/images/${fileName[1]}" alt="Image" onerror="this.src='/placeholder.png'; this.onerror=null;">

Example CSS fix:
.element-with-background {
  background-image: url('/images/${fileName[1]}'), url('/placeholder.png');
}
                    `;
                }
            }
            // API errors
            else if (message.includes('API key') || message.includes('Unauthorized')) {
                instructions = `
Fix for API key error on: ${source}
Error: ${message}

1. Create mock data to replace the API:
   - Add a local JSON file with sample data
   - Replace the API call with local data
   
2. Example fix:
   // Before:
   fetch('${source}')
     .then(res => res.json())
     .then(data => updateUI(data));
   
   // After:
   // First try the API, fall back to local mock data
   fetch('${source}')
     .catch(err => {
       console.log('Using mock data instead of API');
       return { json: () => mockData };
     })
     .then(res => res.json())
     .then(data => updateUI(data));
   
   // Add this at the top of your file:
   const mockData = {
     // Your mock data structure here
   };
                `;
            }
            // CORS errors
            else if (message.includes('CORS') || message.includes('Access-Control-Allow-Origin')) {
                instructions = `
Fix for CORS error on: ${source}
Error: ${message}

Options:
1. Enable CORS on your API (if you control it):
   - Add the following header to your server responses:
   Access-Control-Allow-Origin: *
   
2. Use a CORS proxy for development (not for production):
   - Modify the fetch URL to use a CORS proxy:
   
   // Before:
   fetch('${source}')
   
   // After:
   fetch('https://cors-anywhere.herokuapp.com/${source}')
   
3. Use a local proxy server in your Netlify config (toml file):
   [[redirects]]
     from = "/api/*"
     to = "${source}"
     status = 200
     force = true
                `;
            }
            // Other errors
            else {
                instructions = `
Error detected on: ${source}
Error message: ${message}

Possible fixes:
1. If this is an API failure, implement error handling:
   try {
     // Your existing code
   } catch (err) {
     console.log('Error handled:', err);
     // Fallback behavior
   }

2. If this is a script error, check for:
   - Missing dependencies
   - Script loading order
   - Browser compatibility issues
   - Resource load timing
                `;
            }
            
            return instructions;
        }
        
        // Export error logs
        function exportErrorLogs() {
            const errorData = window.errorCollection.getErrorsAsJson();
            const blob = new Blob([errorData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `error-logs-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showDebugInfo('Error logs exported to JSON file');
        }
        
        // Clear error logs
        function clearErrorLogs() {
            window.errorCollection.clearAll();
            updateErrorDashboard();
            showDebugInfo('Error logs cleared');
        }
        
        // Start initialization when document is loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initialize);
        } else {
            initialize();
        }

        // Refresh all iframes every 5 minutes to keep previews current
        setInterval(() => {
            projects.forEach((project, index) => {
                if (project.useLivePreview) {
                    const iframe = document.getElementById(`iframe-${index}`);
                    if (iframe) {
                        iframe.src = iframe.src;
                    }
                }
            });
        }, 300000); // 5 minutes
        
        // Multi-select functions
        function toggleSelectMode() {
            selectMode = !selectMode;
            selectedCards.clear();
            
            if (selectMode) {
                document.getElementById('multiSelectControls').classList.add('active');
                document.querySelector('.select-mode-button').textContent = 'Cancel Select';
            } else {
                document.getElementById('multiSelectControls').classList.remove('active');
                document.querySelector('.select-mode-button').textContent = 'Select Multiple';
            }
            
            updateSelectedCount();
            renderGallery();
        }
        
        function cancelSelectMode() {
            selectMode = false;
            selectedCards.clear();
            document.getElementById('multiSelectControls').classList.remove('active');
            document.querySelector('.select-mode-button').textContent = 'Select Multiple';
            updateSelectedCount();
            renderGallery();
        }
        
        function toggleCardSelection(name) {
            if (selectedCards.has(name)) {
                selectedCards.delete(name);
            } else {
                selectedCards.add(name);
            }
            updateSelectedCount();
            renderGallery();
        }
        
        function updateSelectedCount() {
            document.getElementById('selectedCount').textContent = selectedCards.size;
        }
        
        function hideSelected() {
            if (selectedCards.size === 0) return;
            
            const confirmMessage = `Hide ${selectedCards.size} selected project${selectedCards.size > 1 ? 's' : ''}?`;
            if (!confirm(confirmMessage)) return;
            
            // Add selected cards to hidden projects
            selectedCards.forEach(name => {
                if (!hiddenProjects.includes(name)) {
                    hiddenProjects.push(name);
                }
            });
            
            // Save to localStorage
            saveHiddenProjects();
            
            // Update projects array
            projects = projects.filter(p => !selectedCards.has(p.name));
            
            // Clear selection and exit select mode
            selectedCards.clear();
            cancelSelectMode();
            
            // Update UI
            updateStats();
            renderGallery();
        }
        
        function showHiddenProjects() {
            if (hiddenProjects.length === 0) {
                alert('No hidden projects to show');
                return;
            }
            
            if (confirm(`Show ${hiddenProjects.length} hidden projects?`)) {
                // Clear hidden projects
                hiddenProjects = [];
                saveHiddenProjects();
                
                // Reload all projects
                loadProjects();
            }
        }
        
        // Handle iframe loading errors
        function handleIframeError(iframe, projectName) {
            console.warn(`Error loading iframe for ${projectName}`);
            
            // Get the parent container and card
            const container = iframe.parentElement;
            const card = container.closest('.project-card');
            
            // Hide the loading spinner
            const loadingSpinner = container.querySelector('.iframe-loading');
            if (loadingSpinner) loadingSpinner.style.display = 'none';
            
            // Show a fallback placeholder
            iframe.style.display = 'none';
            
            // Create a fallback element
            const fallback = document.createElement('div');
            fallback.className = 'project-placeholder';
            fallback.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">📱</div>
                    <div style="font-size: 0.8rem; color: #888;">Preview unavailable</div>
                    <div style="font-size: 0.75rem; margin-top: 0.5rem;">
                        <a href="${iframe.src}" target="_blank" style="color: #06b6d4; text-decoration: underline;">Visit site</a>
                    </div>
                </div>
            `;
            
            // Add to container
            container.appendChild(fallback);
            
            // Update project state to not use live preview in the future
            const project = projects.find(p => p.name === projectName);
            if (project) {
                project.useLivePreview = false;
                saveProjectState(projectName, {
                    size: project.size,
                    roundedCorners: project.roundedCorners,
                    useLivePreview: false
                });
            }
            
            // Log the error in debug
            showDebugInfo(`Disabled live preview for ${projectName} due to loading errors.`);
        }
        
        // Handle screenshot image loading errors
        function handleImageError(img, projectName, projectUrl) {
            console.warn(`Error loading screenshot for ${projectName}`);
            
            // Get the parent container
            const container = img.parentElement;
            
            // Replace the image with a placeholder
            const placeholder = document.createElement('div');
            placeholder.className = 'project-placeholder';
            placeholder.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">🖼️</div>
                    <div style="font-size: 0.8rem; color: #888;">Image unavailable</div>
                    <div style="font-size: 0.75rem; margin-top: 0.5rem;">
                        <a href="${projectUrl}" target="_blank" style="color: #06b6d4; text-decoration: underline;">Visit site</a>
                    </div>
                </div>
            `;
            
            // Replace the image
            img.style.display = 'none';
            container.appendChild(placeholder);
            
            // Log the error
            showDebugInfo(`Could not load screenshot for ${projectName}.`);
            
            // Try enabling live preview for next time if not already enabled
            const project = projects.find(p => p.name === projectName);
            if (project && !project.useLivePreview) {
                project.useLivePreview = true;
                saveProjectState(projectName, {
                    size: project.size,
                    roundedCorners: project.roundedCorners,
                    useLivePreview: true
                });
                showDebugInfo(`Enabling live preview for ${projectName} for next visit.`);
            }
        }
        
        // Handle icon image loading errors
        function handleIconImageError(img, iconName) {
            console.warn(`Error loading icon for ${iconName}`);
            
            // Get the parent container
            const container = img.parentElement;
            
            // Create placeholder
            const placeholder = document.createElement('div');
            placeholder.className = 'project-placeholder';
            placeholder.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">🎨</div>
                    <div style="font-size: 0.8rem; color: #888;">${iconName}</div>
                </div>
            `;
            
            // Replace the image
            img.style.display = 'none';
            container.appendChild(placeholder);
            
            // Log the error
            showDebugInfo(`Could not load icon: ${iconName}`);
        }
        
        // Debugging functions
        function clearAllHidden() {
            if (confirm('Clear all hidden projects? This will show all projects.')) {
                hiddenProjects = [];
                localStorage.removeItem('hiddenProjects');
                loadProjects();
                showDebugInfo('All hidden projects cleared!');
            }
        }
        
        function resetLocalStorage() {
            if (confirm('Reset all settings? This will clear all customizations.')) {
                localStorage.clear();
                location.reload();
            }
        }
        
        function exportSettings() {
            const settings = {
                hiddenProjects: hiddenProjects,
                projectStates: projectStates,
                timestamp: new Date().toISOString()
            };
            
            const json = JSON.stringify(settings, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'gallery-settings.json';
            a.click();
            
            showDebugInfo('Settings exported to gallery-settings.json');
        }
        
        function showDebugInfo(message) {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.textContent = `${new Date().toLocaleTimeString()}: ${message}\n` + debugInfo.textContent;
            debugInfo.classList.add('active');
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                debugInfo.classList.remove('active');
            }, 5000);
        }
    </script>
</body>
</html>